<!-- ============================================================================ -->
<!-- DragonSurvival å…¼å®¹æ€§åˆ†æ”¯ / DragonSurvival Compatibility Fork                -->
<!-- ============================================================================ -->

> [!IMPORTANT]
> **æ­¤åˆ†æ”¯æ·»åŠ äº† DragonSurvival æ¨¡ç»„æ”¯æŒ** / **This fork adds DragonSurvival mod support**
> 
> å¦‚æœä½ åœ¨ä½¿ç”¨ DragonSurvival æ¨¡ç»„ï¼Œè¯·ä½¿ç”¨æ­¤ç‰ˆæœ¬ï¼
> If you are using DragonSurvival mod, use this version!

## ğŸ‰ DragonSurvival å…¼å®¹æ€§ / DragonSurvival Compatibility

### å¿«é€Ÿé¢„è§ˆ / Quick Preview

#### é¾™é£è¡Œ HUD æ¼”ç¤º / Dragon Flight HUD Demo

> [!TIP]
> **è§†é¢‘æ’­æ”¾ / Video Playback:** 
> - GitHub ç½‘é¡µå¯èƒ½æ— æ³•ç›´æ¥æ’­æ”¾è§†é¢‘ï¼Œè¯·**ä¸‹è½½è§†é¢‘æ–‡ä»¶åˆ°æœ¬åœ°æ’­æ”¾**
> - æˆ–åœ¨ GitHub æ¡Œé¢å®¢æˆ·ç«¯ä¸­æŸ¥çœ‹
> - æˆ–ç‚¹å‡»æ–‡ä»¶ååœ¨ GitHub ä¸­æ‰“å¼€
>
> **Video Playback on GitHub:**
> - GitHub web may not play videos directly, **download for local playback**
> - Or view in GitHub desktop client
> - Or click filename to open on GitHub

| ç”Ÿå­˜é£è¡Œå’Œå‘Šè­¦ / Survival Flight & Alerts | åˆ›é€ æ»‘ç¿” / Creative Gliding | åˆ›é€ é£è¡Œ / Creative Flight | åœ°å½¢é€ƒç¦»æµ‹è¯• / Terrain Escape Test |
|------------------------------------------|----------------------------|---------------------------|------------------------------------|
| [ğŸ“¹ ç”Ÿå­˜é£è¡Œå’Œå‘Šè­¦.mp4](./images/ç”Ÿå­˜é£è¡Œå’Œå‘Šè­¦.mp4) <br> <video src="./images/ç”Ÿå­˜é£è¡Œå’Œå‘Šè­¦.mp4" width="200" controls /> | [ğŸ“¹ åˆ›é€ æ»‘ç¿”.mp4](./images/åˆ›é€ æ»‘ç¿”.mp4) <br> <video src="./images/åˆ›é€ æ»‘ç¿”.mp4" width="200" controls /> | [ğŸ“¹ åˆ›é€ é£è¡Œ.mp4](./images/åˆ›é€ é£è¡Œ.mp4) <br> <video src="./images/åˆ›é€ é£è¡Œ.mp4" width="200" controls /> | [ğŸ“¹ åœ°å½¢é€ƒç¦».mp4](./images/åœ°å½¢é€ƒç¦».mp4) <br> <video src="./images/åœ°å½¢é€ƒç¦».mp4" width="200" controls /> |

> **ä¸‹è½½é“¾æ¥ / Download Links:**
> - [ç”Ÿå­˜é£è¡Œå’Œå‘Šè­¦.mp4](./images/ç”Ÿå­˜é£è¡Œå’Œå‘Šè­¦.mp4) (18.1 MB) - ç”Ÿå­˜æ¨¡å¼é£è¡Œ + å‘Šè­¦ç³»ç»Ÿæ¼”ç¤º
> - [åˆ›é€ æ»‘ç¿”.mp4](./images/åˆ›é€ æ»‘ç¿”.mp4) (13.7 MB) - åˆ›é€ æ¨¡å¼æ»‘ç¿”æ¼”ç¤º
> - [åˆ›é€ é£è¡Œ.mp4](./images/åˆ›é€ é£è¡Œ.mp4) (15.0 MB) - åˆ›é€ æ¨¡å¼é£è¡Œæ¼”ç¤º
> - [åœ°å½¢é€ƒç¦».mp4](./images/åœ°å½¢é€ƒç¦».mp4) (25.5 MB) - âœ… åœ°å½¢é€ƒç¦»æµ‹è¯•æˆåŠŸ

#### ç³»ç»Ÿæ¶æ„å›¾ / System Architecture

![System Architecture](images/diagram.png)

#### åŠŸèƒ½ç‰¹æ€§ / Features

- âœ… **é¾™é£è¡ŒçŠ¶æ€æ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«é¾™çš„é£è¡Œ/æ»‘ç¿”çŠ¶æ€
- âœ… **å®Œæ•´ HUD æ”¯æŒ** - ç©ºé€Ÿä»ªã€é«˜åº¦è¡¨ã€é£è¡Œè½¨è¿¹é¢„æµ‹
- âœ… **è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢** - åœ°é¢ â†” é£è¡Œ è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼
- âœ… **é€Ÿåº¦å¹³æ»‘å¤„ç†** - FIR æ»¤æ³¢å™¨æ¶ˆé™¤ HUD æŠ–åŠ¨
- âœ… **æ— éœ€é…ç½®** - è‡ªåŠ¨æ£€æµ‹ DragonSurvival å¹¶å¯ç”¨æ”¯æŒ

#### å®‰è£…è¦æ±‚ / Requirements

| å¿…éœ€ / Required | å¯é€‰ / Optional |
|----------------|-----------------|
| DragonSurvival | YACL (é…ç½®ç•Œé¢) |
| GeckoLib | |
| Architectury API | |
| KFF (NeoForge) / FLK (Fabric) | |

> [!WARNING]
> **ä¸å…¼å®¹æ€§è­¦å‘Š / Incompatibility Warning**
> - âŒ ä¸èƒ½ä¸åŸç‰ˆ FlightAssistant å…±å­˜
> - âŒ æœåŠ¡å™¨å¿…é¡»å®‰è£… DragonSurvival æ‰èƒ½æ˜¾ç¤ºé¾™é£è¡Œ HUD
> 
> - Cannot coexist with vanilla FlightAssistant
> - Server must have DragonSurvival for dragon flight HUD

---

## åŸç‰ˆ FlightAssistant / Original FlightAssistant

<p align=center>
    <img src="images/logo.png">
</p>

<p align=center>
    <a href="https://modrinth.com/mod/flightassistant">
        <img src="https://cdn.jsdelivr.net/npm/@intergrav/devins-badges@3.2.0/assets/cozy/available/modrinth_vector.svg"
            alt="Available on Modrinth"></a>
    <a href="https://modrinth.com/mod/fabric-api/">
        <img src="https://cdn.jsdelivr.net/npm/@intergrav/devins-badges@3.2.0/assets/cozy/requires/fabric-api_vector.svg"
            alt="Requires Fabric API"></a>
    <a href="https://modrinth.com/mod/flightassistant/versions?l=forge&l=neoforge">
        <img src="https://cdn.jsdelivr.net/npm/@intergrav/devins-badges@3.2.0/assets/cozy/supported/forge_vector.svg"
            alt="Available for Forge"></a>
    <a href="https://discord.gg/5kcBCvnbTp">
        <img src="https://cdn.jsdelivr.net/npm/@intergrav/devins-badges@3.2.0/assets/cozy/social/discord-plural_vector.svg"
            alt="Chat with us on Discord"></a>
</p>

---

**FlightAssistant** is a powerful client-side mod that adds fully configurable full-fledged avionics, situational awareness tools and advanced automation to Minecraft elytras, while still being friendly to casual users.

## Main Features

- Fully customizable flight HUD ([wiki](https://github.com/Octol1ttle/FlightAssistant/wiki/HUD))
  - An informative display showing flight data in real time
    <img src="https://github.com/Octol1ttle/FlightAssistant/wiki/img/hud/full_screenshot_alt.png">
- Smart flight safety alerts ([wiki](https://github.com/Octol1ttle/FlightAssistant/wiki/Alerts))
  - Be aware of unsafe flight conditions before it's too late
    <img src="https://github.com/Octol1ttle/FlightAssistant/wiki/img/hud/alert_display_alt.png">
- Non-intrusive automatic flight protections ([wiki](https://github.com/Octol1ttle/FlightAssistant/wiki/Flight-protections))
  - When you're not paying attention, FlightAssistant will protect you
  - Examples: ground collision damage avoidance, void damage avoidance, automatic elytra deploying
- Advanced autopilot with flight planning capabilities: fly safely completely hands-free ([wiki](https://github.com/Octol1ttle/FlightAssistant/wiki/Autopilot%3A-overview-and-basics))
  - Flight plans can be saved to disk and loaded later
  - With flight plans, a flight can be performed completely automatically from takeoff to landing
    <img src="https://github.com/Octol1ttle/FlightAssistant/wiki/img/hud/full_screenshot.png">

### Known Issues & Limitations

#### âš ï¸ Incompatibilities

1. **Cannot coexist with vanilla FlightAssistant**
   - This fork modifies core flight detection logic
   - Installing both will cause conflicts
   - **Solution:** Use only this fork or the original, not both

2. **Server-side requirements**
   - DragonSurvival must be installed on the server
   - FlightAssistant is client-side only
   - Server without DragonSurvival = no dragon flight HUD

#### âš ï¸ Testing Status

**Tested scenarios:**
- âœ… Singleplayer dragon flight
- âœ… Multiplayer dragon flight (DragonSurvival on server)
- âœ… HUD display mode switching
- âœ… Velocity smoothing (FIR filter)

**Untested/Partially tested:**
- âš ï¸ Server with mixed dragon/human players
- âš ï¸ Dragon flight with elytra equipped
- âš ï¸ Compatibility with other flight mods (Do A Barrel Roll, etc.)
- âš ï¸ Long-term stability in production servers

#### âš ï¸ Technical Limitations

1. **Velocity smoothing delay**
   - FIR low-pass filter introduces ~0.25 second delay
   - This is intentional to prevent HUD flickering
   - **Trade-off:** Smooth display vs. real-time accuracy
   - **Adjustment:** Modify `velocityFilterAlpha` in code (0.1-0.3 range)

2. **Reflection-based compatibility**
   - Uses reflection to access DragonSurvival internals
   - May break if DragonSurvival API changes
   - **Risk:** Updates to DragonSurvival may require updates to this fork

3. **Flight state detection**
   - Dragon flight uses `FlightData.areWingsSpread` + `hasFlight`
   - Additional conditions: not on ground, not in water/lava, not passenger
   - May not detect edge cases (spectator mode, creative flight, etc.)

#### âš ï¸ Known Bugs

| Issue | Severity | Workaround |
|-------|----------|------------|
| HUD flickering during rapid flight state changes | Low | FIR filter reduces but doesn't eliminate |
| Velocity display lag (~0.25s) | Low | Intentional design trade-off |
| Server sync delay for dragon flight state | Medium | Depends on server tick rate |
| Possible incompatibility with other flight mods | Unknown | Test before deploying |

### For Maintainers

#### Code Changes

This fork modifies the following core components:

1. **`AirDataComputer.kt`**
   - Added `DragonSurvivalCompat.isDragonFlying()` to flight detection
   - Implemented FIR low-pass filter for velocity smoothing

2. **`HudDisplayDataComputer.kt`**
   - Added independent FIR filter for HUD velocity data
   - Ensures consistency with `AirDataComputer`

3. **`FAConfig.kt`**
   - Updated `display` property to use compound flight detection

4. **`DragonSurvivalCompat.kt`** (new)
   - Reflection-based compatibility layer
   - Detects dragon flight state without hard dependency

#### Parameter Tuning

**Velocity Filter (FIR Low-pass)**
```kotlin
// AirDataComputer.kt & HudDisplayDataComputer.kt
private val velocityFilterAlpha = 0.2  // Adjust this value
```

| Alpha | Cut-off Frequency | Delay | Use Case |
|-------|-------------------|-------|----------|
| 0.1 | ~0.35 Hz | ~0.5s | Maximum smoothness |
| **0.2** | **~0.8 Hz** | **~0.25s** | **Recommended (balanced)** |
| 0.3 | ~1.4 Hz | ~0.15s | Maximum responsiveness |

**Dragon Flight Detection**
```kotlin
// DragonSurvivalCompat.kt
val isDragonFlying = isDragon && hasFlight && areWingsSpread && 
                     !onGround && !inWater && !inLava && !isPassenger
```

#### Testing Checklist

Before merging or releasing:

- [ ] Singleplayer dragon flight HUD
- [ ] Multiplayer dragon flight HUD
- [ ] Elytra flight still works
- [ ] Human player (no dragon) HUD works
- [ ] Flight state transitions (ground â†” air)
- [ ] Velocity display stability
- [ ] No console errors on startup
- [ ] Server compatibility test

#### Reporting Issues

When reporting bugs, please include:

1. Mod versions (FlightAssistant, DragonSurvival, etc.)
2. Loader (NeoForge/Fabric) and version
3. Minecraft version
4. Singleplayer or multiplayer
5. Log file (especially DragonSurvival compatibility logs)
6. Steps to reproduce

---

## Credits

- **Original FlightAssistant:** [Octol1ttle](https://github.com/Octol1ttle/FlightAssistant)
- **DragonSurvival:** [DragonSurvival Team](https://github.com/DragonSurvivalTeam/DragonSurvival)
- **This Fork:** Community contribution for DragonSurvival compatibility

## License

This fork inherits the LGPLv3 license from the original FlightAssistant mod.